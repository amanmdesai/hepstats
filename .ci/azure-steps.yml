steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: '$(python.version)'
    architecture: 'x64'

- bash: |
    if [ $(python.version) == '3.7' ];
        then envfile=".ci/environment_37.yml";
    else
        envfile=".ci/environment_36.yml"
    fi
    conda env create --quiet --file ${envfile}
  displayName: Create Anaconda environment

- bash: |
    source activate scikit-stats-test
    conda install --yes --quiet --name scikit-stats-test python=$PYTHON_VERSION
  displayName: Install Anaconda packages

- bash: |
    source activate scikit-stats-test
    pip install pytest pytest-azurepipelines pytest-cov pytest-runner
    python -m pytest ./tests --doctest-modules --cov=skstats --cov-report=html
  displayName: 'Test with pytest and collect coverage metrics'
